<!DOCTYPE html>
<html>
  <head>
    <title>Block Breaker! WOOT!</title>
  </head>
  <body>
    <canvas id="game" width="1000" height="600"></canvas>
    <script type="text/javascript">
      var blockWidth = 80;
      var blockHeight = 40;
      var backgroundColor = "#FFFFFF"
      function Block() {
        this.x = 0;
        this.y = 0;
        this.width = blockWidth;
        this.height = blockHeight;
        this.color = "#000000";
      }
    
      Block.prototype.render = function() {
        var gameCanvas = document.getElementById("game");
        var ctx = gameCanvas.getContext("2d");
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }

      Block.prototype.clear = function() {
        var blockColor = this.color;
        this.color = backgroundColor;
        this.render();
        this.color = blockColor;
      }

      Block.prototype.isCollision = function(ball) {
        var ballX = ball.x;
        var ballY = ball.y;
        var radius = ball.radius;

        var ballWithinHeight = ((ballY + radius) >= this.y) && ((ballY - radius) <= (this.y + this.height));
        var ballWithinWidth = ((ballX + radius) >= this.x) && ((ballX - radius) <= (this.x + this.width));
        return (ballWithinHeight && ballWithinWidth);
      }

      var ballRadius = 10;
      function Ball() {
        this.x = 0;
        this.y = 0;
        this.radius = ballRadius;
        this.vx = -1.5;
        this.vy = -1.5;
        this.color = "#000000";
      }

      Ball.prototype.render = function() {
        var gameCanvas = document.getElementById("game");
        var ctx = gameCanvas.getContext("2d");
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, 2*Math.PI, false);
        ctx.fill();
      }

      Ball.prototype.clear = function() {
        var gameCanvas = document.getElementById("game");
        var ctx = gameCanvas.getContext("2d");
        ctx.fillStyle = backgroundColor;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius + 2 /* paint a little more than ball to avoid ugly borders lingering */, 0, 2*Math.PI, false);
        ctx.fill();
      }

      var colors = ["#FF0000", "#00FF00", "#0000FF"];
      var blocks = [];

      var gap = 5;
      var blockColumns = 10;
      var blockRows = 4;
      for(var j=0; j < blockRows; j++) {
        var blockColor = colors[j%colors.length];
        for(var i=0; i < blockColumns; i++) {
          block = new Block();
          block.color = blockColor;
          block.x = i * (gap + blockWidth);
          block.y = j * (gap + blockHeight);
          block.render();
          blocks.push(block);
        }
      }

      var gameCanvas = document.getElementById("game");
      var ball = new Ball();
      ball.x = gameCanvas.width / 2;
      ball.y = gameCanvas.height - 50;

      function nextStep() {
        console.log("x, y: " + ball.x + ", " + ball.y);
        ball.clear();
        ball.x = ball.x + ball.vx;
        ball.y = ball.y + ball.vy;
        ball.render();

        for(var i = blocks.length - 1; i >=0; i--) {
          if(blocks[i].isCollision(ball)) {
            ball.vx = ball.vx;
            ball.vy = -ball.vy;
            blocks[i].clear();
            break;
          }
        }

        if(ball.x > -ball.radius && ball.y > -ball.radius) {
          requestAnimationFrame(function() {
              nextStep();
          });
        }
      }
      nextStep();
    </script>
  </body>

</html>
